!function(){function t(t,i){var n=new Date;n.setDate(n.getDate()+3650),document.cookie=[encodeURIComponent(t),"=",i,"; expires="+n.toUTCString(),"; path=/","https:"==window.location.protocol?"; secure":""].join("")}function i(t,i){for(var n,o=document.cookie.split("; "),e=0;n=o[e]&&o[e].split("=");e++)if(decodeURIComponent(n[0])===t)return n[1];return i}if(!window.TCMI&&window.Audio&&window.jQuery){var n=window.jQuery,o={path:"/tcmi/tracks/",tracks:[],firstTrack:0,singlePage:!0,singleFilter:new RegExp("(/|(^|/)[^\\.]+|\\.html?|\\.php)($|\\?)"),singleExclude:null,autoPlay:!0,onBuild:null,onPage:null,onError:function(t){alert(t)}},e=function(){var t=window.TCMI_conf||{},e=this;for(var a in o)this[a]=void 0!==t[a]?t[a]:o[a];if(0===this.tracks.length&&this.onError("No TCMI tracks defined"),this.firstTrack=Math.min(this.firstTrack,this.tracks.length-1),this.build(),this.render(),this.audio=new Audio,n(this.audio).on("play",function(t){e._playing()}).on("ended",function(t){e.next()}).on("error",function(t){var i,n=t.target.error;i=n.code===n.MEDIA_ERR_NETWORK||n.code===n.MEDIA_ERR_SRC_NOT_SUPPORTED?"file could not be found":n.code===n.MEDIA_ERR_DECODE?"your browser cannot play it":"unknown error "+n.code,e.onError("Error playing music: "+i)}),this.filetype=this.audio.canPlayType&&""!==this.audio.canPlayType('audio/ogg; codecs="vorbis"')?".ogg":".mp3",this.autoPlay&&"true"===i("tcmip",!0).toString()){var s=this.autoPlay;"function"==typeof s&&(s=s()),s&&this.load()}this.singlePage&&n(window).on("popstate",function(t){e.openPage(t.originalEvent.state.href,!0)})};e.prototype=n.extend(e.prototype,{$con:null,track:null,playing:!1,build:function(){var t,i,o=this.$con=n('<div id="tcmi"/>'),e=(this.$logo=n('<a href="http://radiac.net/projects/tcmi/" class="tcmi_logo">TCMI</a>').appendTo(o),this.$play=n('<button class="tcmi_play"/>').text("Play").appendTo(o)),a=this.$pause=n('<button class="tcmi_pause"/>').text("Pause").hide().appendTo(o),s=this.$sel=n('<select class="tcmi_select"/>').appendTo(o),r=this.tracks.length;for(t=0;r>t;t++)i=n("<option/>").attr("value",t).text(this.tracks[t][1]).appendTo(s);s.val(this.firstTrack),this.onBuild&&this.onBuild();var l=this;s.change(function(t){l.track=s.val(),l.load()}),e.click(function(t){l.play()}),a.click(function(t){l.pause()})},render:function(){if(this.$con.appendTo("body"),this.singlePage){var t=this,i=window.location.protocol+"//"+window.location.host+"/";n("a").click(function(n){if(t.playing&&this.href&&-1!==this.href.indexOf(i)){if("function"==typeof t.singleFilter){if(!t.singleFilter(this.href))return}else if(null!==t.singleFilter&&!this.href.match(t.singleFilter))return;if("function"==typeof t.singleExclude){if(t.singleExclude(this.href))return}else if(null!==t.singleExclude&&this.href.match(t.singleExclude))return;n.preventDefault(),t.openPage(this.href)}})}},openPage:function(t,i){var o=this;this.onPage&&this.onPage(t),n.get(t,function(e,a,s){return"error"==a?void o.onError("Could not load page: "+s.status+" "+s.statusText):(o.$con.detach(),n("body").html(e),n("head title").text(n("body title").text()),i||window.history.pushState({href:t},"",t),void o.render())})},_load:function(){null===this.track&&(this.track=this.firstTrack),this.audio.setAttribute("src",this.path+this.tracks[this.track][0]+this.filetype),this.audio.load()},load:function(){this._load(),this.play()},next:function(){this.track++,this.track>=this.tracks.length&&(this.track=0),this.$sel.val(this.track),this.load()},play:function(){null===this.track&&this._load(),this.audio.play()},_playing:function(){this.$con.addClass("playing"),this.$play.hide(),this.$pause.show(),this.playing=!0,t("tcmip",!0)},pause:function(){this.audio.pause(),this.$con.removeClass("playing"),this.$play.show(),this.$pause.hide(),this.playing=!1,t("tcmip",!1)}}),n(function(){window.TCMI||(window.TCMI=new e)})}}();
