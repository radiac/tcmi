(function(){if(!!window.TCMI||!window.Audio||!window.jQuery){return}var e=window.jQuery,t={path:"/tcmi/tracks/",tracks:[],firstTrack:0,singlePage:true,autoPlay:true,onBuild:null,onPage:null,onError:function(e){alert(e)}};var n=function(){var n=window.TCMI_conf||{},r=this;for(var i in t){this[i]=n[i]!==undefined?n[i]:t[i]}if(this.tracks.length===0){this.onError("No TCMI tracks defined")}this.firstTrack=Math.min(this.firstTrack,this.tracks.length-1);this.build();this.render();this.audio=new Audio;e(this.audio).bind("ended",function(e){r.next()}).bind("error",function(e){var t=e.target.error,n;if(t.code===t.MEDIA_ERR_NETWORK||t.code===t.MEDIA_ERR_SRC_NOT_SUPPORTED){n="file could not be found"}else if(t.code===t.MEDIA_ERR_DECODE){n="your browser cannot play it"}else{n="unknown error "+t.code}r.onError("Error playing music: "+n)});this.filetype=!!this.audio.canPlayType&&this.audio.canPlayType('audio/ogg; codecs="vorbis"')!==""?".ogg":".mp3";if(this.autoPlay){this.load()}if(this.singlePage){e(window).bind("popstate",function(e){r.openPage(e.originalEvent.state.href,true)})}};n.prototype=e.extend(n.prototype,{$con:null,track:null,build:function(){var t=this.$con=e('<div id="tcmi"/>'),n=this.$logo=e('<a href="http://radiac.net/projects/tcmi/" class="tcmi_logo">TCMI</a>').appendTo(t),r=this.$play=e('<button class="tcmi_play"/>').text("Play").appendTo(t),i=this.$pause=e('<button class="tcmi_pause"/>').text("Pause").hide().appendTo(t),s=this.$sel=e('<select class="tcmi_select"/>').appendTo(t),o,u=this.tracks.length,a;for(o=0;o<u;o++){a=e("<option/>").attr("value",o).text(this.tracks[o][1]).appendTo(s)}s.val(this.firstTrack);if(this.onBuild){this.onBuild()}var f=this;s.change(function(e){f.track=s.val();f.load()});r.click(function(e){f.play()});i.click(function(e){f.pause()})},render:function(){this.$con.appendTo("body");if(!this.singlePage){return}var t=this,n=window.location.protocol+"//"+window.location.host+"/";e("a").click(function(e){if(!this.href||this.href.indexOf(n)===-1){return}e.preventDefault();t.openPage(this.href)})},openPage:function(t,n){var r=this;if(this.onPage){this.onPage(t)}e("body").load(t,function(e,i,s){if(i=="error"){r.onError("Could not load page: "+s.status+" "+s.statusText);return}if(!n){window.history.pushState({href:t},"",t)}r.render()})},_load:function(){if(this.track===null){this.track=this.firstTrack}this.audio.setAttribute("src",this.path+this.tracks[this.track][0]+this.filetype);this.audio.load()},load:function(){this._load();this.play()},next:function(){this.track++;if(this.track>=this.tracks.length){this.track=0}this.load()},play:function(){if(this.track===null){this._load()}this.audio.play();this.$con.addClass("playing");this.$play.hide();this.$pause.show()},pause:function(){this.audio.pause();this.$con.removeClass("playing");this.$play.show();this.$pause.hide()}});e(function(){if(!!window.TCMI){return}window.TCMI=new n})})()